import pymysql
class clinic :
    def __init__ (self , clinic_id , address , clinic_contact_info , clinic_password , capacity , service , connection) :
        self.clinic_id = clinic_id
        self.address = address
        self.clinic_contact_info = clinic_contact_info
        self.clinic_password = clinic_password
        self.capacity = capacity
        self.service = service
        self.connection = connection


    def get_info (self) :
        if len(self.clinic_contact_info) != 8 :
            print('The phone number is incorrect')
        elif len(self.clinic_password) < 8 or not any (c.isdigit for c in self.clinic_password) :
            print('The password is weak.')
        else :
            return {
                'clinic_id': self.clinic_id ,
                'address': self.address ,
                'clinic_contact_info': self.clinic_contact_info ,
                'clinic_password': self.clinic_password ,
                'capacity': self.capacity ,
                'service': self.service
            }
    
    
    def insert_data(self) :
        data = self.get_info()
        if data is not None :
            with self.connection.cursor() as cursor :
                sql = """
                INSERT INTO clinics (clinic_id , capacity , address , service , clinic_contact_info , clinic_password) 
                VALUES (%s , %s , %s , %s , %s , %s)
                """
                cursor.execute(sql , (data['capacity'] , data['address'] , data['service'] , data['clinic_contact_info'], data['clinic_password']))
            self.connection.commit()

      




class secretary :
    def __init__ (self , secretary_name , clinic , connection):
        self.secretary_name = secretary_name
        self.clinic_password = clinic.clinic_password
        self.clinic_id = clinic.clinic_id
        self.connection = connection


    def get_info(self) :
        return {
            'secretary_name': self.secretary_name ,
            'clinic_name': self.clinic_name , 
            'clinic_password': self.clinic_password
        }
    
    def insert_data(self) :
        data = self.get_info()
        if data is not None :
            with self.connection.cursor() as cursor :
                sql = """
                INSERT INTO secretary (current_appointments , current_capacity , patient_natinal_code , patient_name , patient_contact_info) 
                VALUES (%s , %s , %s , %s , %s)
                """
                cursor.execute(sql, (data['patient_natinal_code'], data['patient_name'], data['patient_contact_info']))
            self.connection.commit()





class appointment :
    def __init__(self , add_apointment , clinic , remove_appointment , connection) :
        self.add_apointment = add_apointment
        self.service = clinic.service
        self.capacity = clinic.capacity
        self.remove_appointment = remove_appointment
        self.connection = connection
    
    
    def add_appointment(self , appointment) :
        if self.capacity > 0 :
            self.add_appointment.append(appointment)
            self.capacity -= 1
            return 'Appointment added successfully!'
        else:
            return 'No capacity left!'

    def remove_appointment(self , appointment) :
        if appointment in self.add_appointment :
            self.add_appointment.remove(appointment)
            self.capacity += 1
            return 'Appointment removed successfully!'
        else:
            return 'Appointment not found!'




connection = pymysql.connect(host = 'localhost' ,
                             user = 'root' ,
                             password = 'APterm3r@r@8304' ,
                             database = 'APclinics')